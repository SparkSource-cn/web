---
layout: page
title: 车载 HMI 中 3D 模型的性能优化
description: talk about how to improve 3D module's rendering performance
---


可以想象，智能网联时代的汽车就像智能手机一样，除了基础的驾驶功能之外，在汽车天然
的大空间之下的多个屏幕之上会出现丰富多彩、超出想象的应用。这些应用除了核心功能外，
也会使用先进的人机界面（HMI）技术拉近机器与人类感官的距离，从而提升应用的表现力
和娱乐水平，满足数字时代用户永远无法满足的、对性能和功能的追求与攀比。

先进的人机界面技术通常都要设计和开发复杂而有难度的 3D 模型。建立在复杂 3D 模型之
上的人机界面处理除了要求开发者有扎实的数学基础和优秀的建模方法，还需要了解硬件
（显卡、GPU）和图形库的工作原理，在设计架构时要充分发挥 GPU 的硬件加速能力，而且
具体实现要注意许多影响效率的细节，其中包括对资源的优化管理。

回归到汽车本身，与汽车直接相关的应用都会用到虚拟化的实车模型。比如，车辆设置可以
让你看到在 3D 汽车模型上相关部件在设置之后的变化；辅助驾驶可以让你看到虚拟汽车周
围的实际情况；越野导航可以让你用视觉体会虚拟汽车在崎岖路面的状态；智能诊断可以让
你看到全部底盘的磕碰情况。这些非常使用且酷炫的功能都需要建立整车的 3D 模型，更重
要的是人机界面的开发环境要能够高效地解析和展示 3D 模型。

SparkSource 完全自主开发的 SparkEngine 内置高效图形引擎，能够轻松导入用 3DMax 等
建模工具构建的 obj 文件，并提供一大类 3D 应用的共性功能，开发人员无需编写代码或
者只需要编写很少量的定制代码就可以实现最终的 3D 应用。

在实际应用之中，我们还发现 3D 模型设计人员和 3D 应用开发人员之间的配合对提高最终
应用在目标板卡上的性能也相当重要。因为车载芯片 GPU 的性能再强劲，也是有限度的——
通常无法和台式模型设计电脑的配置相提并论。要在车载系统上展示出台式电脑上的 3D 应
用效果，需要注意很多细节。

举个例子，虚拟车的模型通常都是从真车的机械模型转换过来的。做过的人都知道，机械模
型需要对每个单元都单独建模，非常的精细——通常会有数千、乃至上万的小模型，最后拼接
成为整车的模型：

* 车轮：轮胎、轮毂

* 底盘：悬挂、支架

* 传动：转向、变速箱、传动臂

* 车身：前窗、车门、车窗、天窗、后备箱、后视镜

* 车灯：前大灯、前小灯、转向灯、刹车灯、氛围灯

* 内饰：中控台、座椅

这里仅列出众所周知的主要部件，其实汽车里的部件远不止这些，车模里也不可能全部都包
括，也没有必要。

但是，这几千个小模型如果不加处理全都交给应用开发，那么图像渲染的工作量就非常之大。
这个工作量目前还是车载嵌入式系统的的芯片不可承受之重。处理是必然的。处理的方法一
般是合并同类项——把 3D 应用中不变的部件合在一起，把变化的部件单列出来。比如，整个
车身，如果只有大灯、天窗和车门会在应用中有设置等变化，那么车身的其他部分就组合成
一个大模型。这样模型的数目就大大减少了，引擎解析模型的性能就大大提高了。

模型的减少并不一定意味着虚拟车需要 HMI 解析的表面或多边形的减少。比如，大灯、天
窗、车门和车身组合也会有数千个三角形表面需要渲染——表面越多，渲染出来的效果越好。
光线细腻柔和，转动平滑流畅。SparkSource 常规可以轻松处理上万个三角形表面的同时渲
染。因为这些三角形来自原来的数千个小模型，设计人员和开发人员一定要非常细致，要注
意合并同类项时拉平模型之间的缝隙、剔除模型之间的不平滑。否则，在渲染时就会出现锯
齿、星星斑点、小黑洞以及棱角等让人觉得非常不舒服的缺陷。所以，模型的合并同类项是
一个细工慢活。

虚拟车模型整合好之后，剩下的工作就可以交给 SparkSource 来帮助开发人员发挥想象力
了。无论是颜色、质地、光线、声音、动效，也无论是整体还是局部，也无论是 2D 还是
3D 还是混合，SparkSource 都提供了无需编写代码的 HMI 逻辑和画面实现方法，让复杂的
项目变得简单有趣。

SparkSource 和您的团队一起打造未来车载 HMI 新天地。
